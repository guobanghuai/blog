<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>gulp相关 | blog</title>
    <meta name="description" content="blog from Qi">
    <link rel="icon" href="/blog/images/favicon.png">
  <meta name="theme-color" content="#00adb5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#00adb5">
  <meta name="description" itemprop="description" content="blog from Qi">
  <meta itemprop="name" content="js_trick">
  <meta itemprop="image" content="/js_tricks/images/favicon.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8be14f65.css" as="style"><link rel="preload" href="/blog/assets/js/app.c707ba38.js" as="script"><link rel="preload" href="/blog/assets/js/25.dac15c80.js" as="script"><link rel="preload" href="/blog/assets/js/2.e9cd7337.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.17c0b57d.js"><link rel="prefetch" href="/blog/assets/js/11.9aadbfba.js"><link rel="prefetch" href="/blog/assets/js/12.69153d9c.js"><link rel="prefetch" href="/blog/assets/js/13.0a44e59a.js"><link rel="prefetch" href="/blog/assets/js/14.f32d415a.js"><link rel="prefetch" href="/blog/assets/js/15.692b6d9a.js"><link rel="prefetch" href="/blog/assets/js/16.35dbae08.js"><link rel="prefetch" href="/blog/assets/js/17.af0711c0.js"><link rel="prefetch" href="/blog/assets/js/18.08f59d7f.js"><link rel="prefetch" href="/blog/assets/js/19.96b788c7.js"><link rel="prefetch" href="/blog/assets/js/20.b04b7c9c.js"><link rel="prefetch" href="/blog/assets/js/21.744660d2.js"><link rel="prefetch" href="/blog/assets/js/22.d4882bd4.js"><link rel="prefetch" href="/blog/assets/js/23.2179b4ab.js"><link rel="prefetch" href="/blog/assets/js/24.ed55aa76.js"><link rel="prefetch" href="/blog/assets/js/26.fd941958.js"><link rel="prefetch" href="/blog/assets/js/27.42bd57da.js"><link rel="prefetch" href="/blog/assets/js/28.3dc86a52.js"><link rel="prefetch" href="/blog/assets/js/29.84516804.js"><link rel="prefetch" href="/blog/assets/js/3.59364ffe.js"><link rel="prefetch" href="/blog/assets/js/4.606673b8.js"><link rel="prefetch" href="/blog/assets/js/5.a644421f.js"><link rel="prefetch" href="/blog/assets/js/6.7062016e.js"><link rel="prefetch" href="/blog/assets/js/7.6f3d948d.js"><link rel="prefetch" href="/blog/assets/js/8.aedad399.js"><link rel="prefetch" href="/blog/assets/js/9.366b0920.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8be14f65.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>实现</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>basic</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>leetcode</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>其他</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/other/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/blog/other/gulp.html" class="active sidebar-link">gulp相关</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/other/pixi.html" class="sidebar-link">PixiJS</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="gulp相关">gulp相关</h1> <h3 id="_1-安装">1.安装</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev gulp 
</code></pre></div><h3 id="_2-使用">2.使用</h3> <div class="language- extra-class"><pre class="language-text"><code>gulp    打包
gulp taskname   执行自定义的某个gulp任务
</code></pre></div><h3 id="_3-api">3.API</h3> <p>####——需要知道四个API：gulp.task , gulp.src , gulp.dest , gulp.watch</p> <h4 id="_3-1-gulp-src">3.1 gulp.src</h4> <p>获取文件（以进行操作)</p> <div class="language- extra-class"><pre class="language-text"><code>gulp.src(globs[, options])
</code></pre></div><p>globs参数是文件匹配模式(类似正则表达式)，用来匹配文件路径(包括文件名)，当然这里也可以直接指定某个具体的文件路径。</p> <p>当有多种匹配模式时可以使用数组</p> <div class="language- extra-class"><pre class="language-text"><code>//使用数组的方式来匹配多种文件
gulp.src(['js/*.js','css/*.css','*.html'])
</code></pre></div><h4 id="_3-2-gulp-dest">3.2 gulp.dest</h4> <p>输出文件（在文件进行操作后）</p> <div class="language- extra-class"><pre class="language-text"><code>gulp.dest(path[,options])
</code></pre></div><p>path为写入文件的路径</p> <p>options为一个可选的参数对象，通常我们不需要用到</p> <p>要想使用好gulp.dest()这个方法，就要理解给它传入的路径参数与最终生成的文件的关系。</p> <p>gulp的使用流程一般是这样子的：首先通过gulp.src()方法获取到我们想要处理的文件流，然后把文件流通过pipe方法导入到gulp的插件中，最后把经过插件处理后的流再通过pipe方法导入到gulp.dest()中，gulp.dest()方法则把流中的内容写入到文件中，这里首先需要弄清楚的一点是，我们给gulp.dest()传入的路径参数，只能用来指定要生成的文件的目录，而不能指定生成文件的文件名，它生成文件的文件名使用的是导入到它的文件流自身的文件名，所以生成的文件名是由导入到它的文件流决定的，即使我们给它传入一个带有文件名的路径参数，然后它也会把这个文件名当做是目录名，例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/jquery.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist/foo.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//最终生成的文件路径为 dist/foo.js/jquery.js,而不是dist/foo.js</span>
</code></pre></div><p>要想改变文件名，可以使用插件gulp-rename</p> <p>下面说说生成的文件路径与我们给<code>gulp.dest()</code>方法传入的路径参数之间的关系。</p> <p><code>gulp.dest(path)</code>生成的文件路径是我们传入的path参数后面再加上<code>gulp.src()</code>中有通配符开始出现的那部分路径。
如果没有通配符，那么输出路径就是<code>gulp.dest(path)</code>中path的路径下
例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">reruire</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//有通配符开始出现的那部分路径为 **/*.js</span>
gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/**/*.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最后生成的文件路径为 dist/**/*.js</span>
<span class="token comment">//如果 **/*.js 匹配到的文件为 jquery/jquery.js ,则生成的文件路径为 dist/jquery/jquery.js</span>
</code></pre></div><p>通过指定<code>gulp.src()</code>方法配置参数中的base属性，我们可以更灵活的来改变<code>gulp.dest()</code>生成的文件路径。
当我们没有在<code>gulp.src()</code>方法中配置base属性时，base的默认值为通配符开始出现之前那部分路径，例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'app/src/**/*.css'</span><span class="token punctuation">)</span> <span class="token comment">//此时base的值为 app/src</span>
</code></pre></div><p>上面我们说的gulp.dest()所生成的文件路径的规则，其实也可以理解成，用我们给gulp.dest()传入的路径替换掉gulp.src()中的base路径，最终得到生成文件的路径。而base的默认属性就是<code>gulp.src()</code>中有通配符开始出现的那部分路径或者是<code>gulp.src()</code>中文件前的路径（没有出现通配符的情况下）</p> <p>所以改变base路径后，gulp.dest()生成的文件路径也会改变</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/lib/*.js'</span><span class="token punctuation">)</span> <span class="token comment">//没有配置base参数，此时默认的base路径为script/lib</span>
    <span class="token operator">/</span><span class="token operator">/</span>假设匹配到的文件为script<span class="token operator">/</span>lib<span class="token operator">/</span>jquery<span class="token punctuation">.</span>js
<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span>生成的文件路径为 build<span class="token operator">/</span>jquery<span class="token punctuation">.</span>js

gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/lib/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>base<span class="token punctuation">:</span><span class="token string">'script'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//配置了base参数，此时base路径为script</span>
    <span class="token operator">/</span><span class="token operator">/</span>假设匹配到的文件为script<span class="token operator">/</span>lib<span class="token operator">/</span>jquery<span class="token punctuation">.</span>js
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span>此时生成的文件路径为 build<span class="token operator">/</span>lib<span class="token operator">/</span>jquery<span class="token punctuation">.</span>js    
</code></pre></div><p>用<code>gulp.dest()</code>把文件流写入文件后，文件流仍然可以继续使用。</p> <h4 id="_3-3-gulp-task">3.3 gulp.task</h4> <p>定义gulp任务</p> <div class="language- extra-class"><pre class="language-text"><code>gulp.task(name[, deps], fn)
</code></pre></div><p>name 为任务名</p> <p>deps 是当前定义的任务需要依赖的其他任务，为一个数组。当前定义的任务会在所有依赖的任务执行完毕后才开始执行。如果没有依赖，则可省略这个参数</p> <p>fn 为任务函数，我们把任务要执行的代码都写在里面。该参数也是可选的。</p> <p>在执行多个任务时，可以通过任务依赖实现，即创建一个空的任务来放置其他任务依赖</p> <p>如果任务相互之间没有依赖，任务会按你书写的顺序来执行，如果有依赖的话则会先执行依赖的任务。</p> <p>但是如果某个任务所依赖的任务是异步的，就要注意了，gulp并不会等待那个所依赖的异步任务完成，而是会接着执行后续的任务。例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//one是一个异步执行的任务</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'one is done'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//two任务虽然依赖于one任务,但并不会等到one任务中的异步操作完成后再执行</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的例子中我们执行two任务时，会先执行one任务，但不会去等待one任务中的异步操作完成后再执行two任务，而是紧接着执行two任务。所以two任务会在one任务中的异步操作完成之前就执行了。</p> <p>那如果我们想等待异步任务中的异步操作完成后再执行后续的任务
有三种方法可以实现：
第一：在异步操作完成后执行一个回调函数来通知gulp这个异步任务已经完成,这个回调函数就是任务函数的第一个参数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//cb为任务函数提供的回调，用来通知任务已经完成</span>
  <span class="token comment">//one是一个异步执行的任务</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'one is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//执行回调，表示这个异步任务已经完成</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//这时two任务会在one任务中的异步操作完成后再执行</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>第二：定义任务时返回一个流对象。适用于任务就是操作gulp.src获取到的流的情况。(将流强行带到任务one中，使流在任务one执行完后才能继续)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> stream <span class="token operator">=</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'client/**/*.js'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dosomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//dosomething()中有某些异步操作</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第三：返回一个promise对象，例如</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-4-gulp-watch">3.4 gulp.watch</h4> <p>监听文件变化，当出现变化时作出指定的task</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>glob<span class="token punctuation">[</span><span class="token punctuation">,</span> opts<span class="token punctuation">]</span><span class="token punctuation">,</span> tasks<span class="token punctuation">)</span>
</code></pre></div><p>glob 为要监视的文件匹配模式，规则和用法与gulp.src()方法中的glob相同</p> <p>opts 为一个可选的配置对象，通常不需要用到</p> <p>tasks 为文件变化后要执行的任务，为一个数组</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'uglify'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'reload'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'js/**/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'uglify'</span><span class="token punctuation">,</span><span class="token string">'reload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>gulp.watch()</code>还有另外一种使用方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>glob<span class="token punctuation">[</span><span class="token punctuation">,</span> opts<span class="token punctuation">,</span> cb<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>glob和opts参数与第一种用法相同</p> <p>cb参数为一个函数。每当监视的文件发生变化时，就会调用这个函数,并且会给它传入一个对象，该对象包含了文件变化的一些信息，type属性为变化的类型，可以是<code>added</code>,<code>changed</code>,<code>deleted</code>,<code>path</code>属性为发生变化的文件的路径</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'js/**/*.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//变化类型 added为新增,deleted为删除，changed为改变 </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//变化的文件的路径</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h3 id="_4-使用插件">4.使用插件</h3> <h4 id="_4-1-快速启动插件">4.1    快速启动插件</h4> <p>当我们使用插件时，需要将每一个插件require，如果使用的插件较多，那么需要的require会造成代码十分冗长，所以我们最先使用的是<code>gulp-load-plugins</code>插件</p> <p><code>gulp-load-plugins</code>插件可以自动加载package.json文件里的gulp插件。例如假设你的package.json文件里的依赖是这样的:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;devDependencies&quot;: {
    &quot;gulp&quot;: &quot;~3.6.0&quot;,
    &quot;gulp-rename&quot;: &quot;~1.2.0&quot;,
    &quot;gulp-ruby-sass&quot;: &quot;~0.4.3&quot;,
    &quot;gulp-load-plugins&quot;: &quot;~0.5.1&quot;
  }
}
</code></pre></div><p>然后我们可以在<code>gulpfile.js</code>中使用<code>gulp-load-plugins</code>来帮我们加载插件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//加载gulp-load-plugins插件，并马上运行它</span>
<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们要使用gulp-rename和gulp-ruby-sass这两个插件的时候，就可以使用<code>plugins.rename</code>和<code>plugins.rubySass</code>来代替了,也就是原始插件名去掉gulp-前缀，之后再转换为驼峰命名。</p> <h4 id="_4-2-browsersync">4.2    Browsersync</h4> <p>开启本地代理服务器，实现同步刷新</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm install browser-sync gulp --save-dev
</code></pre></div> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/other/性能优化.html" class="prev">
          性能优化
        </a></span> <span class="next"><a href="/blog/other/pixi.html">
          PixiJS
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.c707ba38.js" defer></script><script src="/blog/assets/js/25.dac15c80.js" defer></script><script src="/blog/assets/js/2.e9cd7337.js" defer></script>
  </body>
</html>
